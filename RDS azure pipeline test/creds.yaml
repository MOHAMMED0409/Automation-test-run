trigger:
- main

pool:
  name: Default # Self-hosted agent pool

jobs:
- job: SetupAWS
  displayName: 'Job 1 - Configure AWS Credentials from Azure Variables'
  steps:
  - script: |
      echo "Checking if AWS CLI is already installed..."
      if command -v aws &> /dev/null; then
        echo "AWS CLI is already installed. Skipping installation."
      else
        echo "AWS CLI not found. Installing..."
        sudo apt-get update && sudo apt-get install -y awscli
      fi
    displayName: 'Check and Install AWS CLI'

  - script: |
      echo "Setting AWS credentials from Azure environment variables..."
      export AWS_ACCESS_KEY_ID=$(AWS_ACCESS_KEY_ID)
      export AWS_SECRET_ACCESS_KEY=$(AWS_SECRET_ACCESS_KEY)
      export AWS_DEFAULT_REGION=$(AWS_DEFAULT_REGION)
    displayName: 'Set AWS Credentials'

  - script: |
      echo "Verifying AWS credentials..."
      echo "AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID"
      echo "AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:0:4}****"
      echo "AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION"
    env:
      AWS_ACCESS_KEY_ID: $(AWS_ACCESS_KEY_ID)
      AWS_SECRET_ACCESS_KEY: $(AWS_SECRET_ACCESS_KEY)
      AWS_DEFAULT_REGION: $(AWS_DEFAULT_REGION)
    displayName: 'Configure and Verify AWS Credentials'